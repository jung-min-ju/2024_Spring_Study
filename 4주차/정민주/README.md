# 2024_Spring_Study

2주간의 과제 입니다.

## 로그인, 회원가입 구현
## 1. 회원가입
>* EndPoint: POST /api/auth/signUp
회원가입 API

### **과정**
1. 사용자는 이름, 이메일, 전화번호, 비밀번호, 비밀번호 재확인 칸을 통해 회원가입을 진행합니다.
2. 이메일 인증/전화번호 인증을 하지 않은 사용자는 회원가입을 진행할 수 없습니다.
3. 비밀번호 재확인을 하지 않은 사용자는 회원가입을 진행할 수 없습니다.

---

### 1-1. 이메일 인증 API

### **전송 과정**
> Endpoint: POST /api/auth/email/send
이메일로 인증 번호 전송 api

1. 사용자가 해당 api의 body에 인증하고 싶은 이메일을 담아 서버에게 요청합니다.
2. 서버는 6글자의 랜덤 인증 번호를 생성 후, 사용자의 이메일로 해당 인증 번호를 전송합니다.

### **확인 과정**
> Endpoint: POST /api/auth/email/check
이메일 인증 번호 확인 api

1. 사용자는 본인의 이메일로 전송된 인증번호 확인 후, 해당 api로 본인의 이메일 및 인증번호를 전송합니다.
2. 해당 번호가 서버에서 보낸 번호와 일치하지 않을 시, 에러가 발생합니다.

(주의할 점 : 인증번호는 매번 달라야 합니다.)

-----

### 1-2. 전화번호 인증 API
### **전송 과정**
>  Endpoint: POST /api/auth/phone/send
전화번호로 인증 번호 전송 api

1. 사용자가 해당 api의 body에 인증하고 싶은 전화번호를 담아 서버에게 요청합니다. (- 없이 11자리로만 전송합니다.)
2. 서버는 6글자의 랜덤 인증 번호를 생성 후, 사용자의 전화번호로 해당 인증 번호를 전송합니다.

### **확인 과정**
>* Endpoint: POST /api/auth/phone/check
전화번호 인증 번호 확인 api

1. 사용자는 본인의 문자로 전송된 인증번호 확인 후, 해당 api로 본인의 전화번호 및 인증번호를 전송합니다.
2. 해당 번호가 서버에서 보낸 번호와 일치하지 않을 시, 에러가 발생합니다.

(주의할 점 : 인증번호는 매번 달라야 합니다.)

-----

### 1-3. 비밀번호 일치 Api
> * EndPoint: POST /api/auth/password/check
비밀번호 일치 확인 API

### **과정**
1. 사용자는 해당 API로 비밀번호 및 비밀번호 재확인 값을 보냅니다.
2. 서버는 두 값이 일치하는 지 확인 후, 일치한다면 OK, 일치하지 않다면 에러를 발생시킵니다.

-------

## 2. 로그인
### **과정**
1. 사용자는 특정 이메일과 비밀번호를 사용하여 로그인을 진행합니다.
2. 로그인이 통과된다면 response에는 accessToken과 refreshToken을 담아 전송합니다.
3. 로그인이 통과되지 못한다면 에러를 발생시킵니다.

### 2-1. 로그인
* EndPoint: POST /api/auth/signIn
로그인 API

### **과정**
1. 사용자가 해당 API로 요청 보낼 시, 로그인 정보가 일치하다면 responseBody에 json 형태로 accessToken과 refreshToken을 보냅니다.

----

## 3. Jwt
### **과정**
1. 로그인 시, 해당 사용자에게 새롭게 부여되는 accesesToken/refreshToken을 부여합니다.
2. 모든 http 요청에서 인가 여부를 확인합니다.
  *   만약 인가가 필요하지 않은 url의 경우, jwt 로직을 진행하지 않고 바로 컨트롤러로 넘어갑니다.
  *   만약 인가가 필요한 경우, 헤더에서 토큰을 가져와 jwt 로직을 진행합니다.

### 3-1. jwt 로직
1. 헤더에서 토큰(accessToken)을 가져옵니다.
2. 인가가 필요한 url인데 헤더에 토큰이 없는 경우/토큰 만료여부/비밀키 일치여부 등등 토큰과 관련된 예외처리를 구현합니다. (만약 발생 가능한 예외가 있는데도 잡지 못하고 jwt 필터를 통과해선 안됩니다.)
3. 해당 토큰에서 정보를 가져와 userDetails 객체 생성 후, authentication 객체로 생성합니다.

### 3-2. 어세스 토큰 재발급
> EndPoint: POST /jwt/update/access/token
어세스 토큰 재발급 API 

1. 헤더에 refreshToken을 넣어 전송합니다.
2. 해당 리프래시 토큰 검증 후, 검증이 완료되었을 때 새로운 AccessToken을 재발급합니다.
3. 재발급된 AccessToken을 body에 담아 응답으로 보냅니다.

-----

😊 위 url 들은 모두 인가가 필요없습니다. 아래의 url은 모두 인가 요청을 거쳐야 합니다. 😊

----

## 파일 업로드 및 관리 애플리케이션
### 개요
이 애플리케이션은 사용자가 파일을 서버에 업로드하고, 업로드된 파일을 관리(조회, 다운로드, 삭제)할 수 있는 기능을 제공합니다. 각 사용자는 자신의 파일을 관리할 수 있으며, 파일의 메타데이터는 데이터베이스에 저장됩니다.


## 1. 데이터베이스 설계
### User 테이블
설명: 애플리케이션 사용자 정보를 저장하는 테이블입니다. 

컬럼 정의:

* user_id: Integer (사용자의 고유 ID)

* username: 
Varchar(255), 사용자 이름

* email: 
Varchar(255), 사용자 이메일 주소

* phoneNumber:
Varchar(255), 사용자 전화번호

* password: 
Varchar(255), 사용자 비밀번호


### FileMetaData 테이블
설명: 업로드된 파일의 메타데이터를 저장하는 테이블입니다.

컬럼 정의:


* id: Integer, Primary Key, Auto Increment, 파일의 고유 ID
* file_name: Varchar(255), 업로드된 파일의 원본 이름
* file_path: Varchar(255), 파일이 저장된 url(s3에서 반환 예정)
* file_size: Long, 파일의 크기 (바이트 단위)
* upload_time: Timestamp, 파일이 업로드된 시간 (기본값: 현재 시간)
* content_type: Varchar(100), 파일의 MIME 타입
* user_id: Integer, Foreign Key, 파일을 업로드한 사용자의 ID (참조: User.user_id)


## 2. API 정의
### 2-1. 파일 업로드 API
> Endpoint: POST /api/files/upload

* 설명: 사용자가 파일을 업로드하면 서버에 저장되고, 파일의 메타데이터가 데이터베이스에 저장됩니다. 파일은 업로드한 사용자와 연관됩니다.
* Request Body:
multipart/form-data 형식으로 파일을 업로드
업로드하는 사용자의 정보
* Response:
Status: 
  * 200 OK (업로드 성공 시)
  *  Error: 400 Bad Request (파일이 없거나 잘못된 요청)

### 2-2. 파일 목록 조회 API
> Endpoint: GET /api/files/{id}

설명: 서버에 본인이 업로드 한 파일의 목록을 조회합니다. (본인이 올린 파일이 아니라면 조회할 수 없습니다.)
id: 사용자의 고유 id를 의미합니다.
* Path Variable:
id: 파일의 고유 ID
* Response: Status:
  *  200 OK (삭제 성공 시)
   * Error: 404 Not Found (지정된 ID의 파일이 존재하지 않는 경우)
 
 ### 2-3. 파일 다운로드 API
> Endpoint: GET /api/files/{id}/download

* 설명: 지정된 ID의 파일을 다운로드합니다. 사용자는 자신의 파일만 다운로드할 수 있습니다.
* Path Variable:
id: 파일의 고유 ID
* Response:
Status:
  *  200 OK (정상 처리 시)
  * Error: 404 Not Found (지정된 ID의 파일이 존재하지 않거나, 사용자가 해당 파일에 접근할 권한이 없을 시)

### 2-4. 파일 삭제 API
> Endpoint: DELETE /api/files/{id}

* 설명: 지정된 ID의 파일을 서버와 데이터베이스에서 삭제합니다. 사용자는 자신의 파일만 삭제할 수 있습니다.
* Path Variable:
id: 파일의 고유 ID
* Response: Status:
  *  200 OK (삭제 성공 시)
   * Error: 404 Not Found (지정된 ID의 파일이 존재하지 않거나, 사용자가 해당 파일에 접근할 권한이 없을 시)

## 3. 주요 기능 설명
### 사용자 관리:

각 사용자는 고유한 계정(ID, 이메일, 비밀번호)을 가지고 있으며, 파일을 업로드하고 관리할 수 있습니다.

### 파일 업로드:

사용자가 파일을 업로드할 수 있으며, 서버는 해당 파일을 지정된 디렉토리에 저장합니다.
파일의 메타데이터(파일 이름, 경로, 크기, MIME 타입, 업로드한 사용자 등)가 데이터베이스에 저장됩니다.

### 파일 목록 조회:

사용자는 자신의 업로드된 파일들의 목록을 조회할 수 있습니다. 이 목록에는 파일의 주요 정보(이름, 업로드 시간 등)가 포함됩니다.

### 파일 다운로드:

사용자는 자신이 업로드한 파일을 선택하여 다운로드할 수 있습니다. 파일은 원본 이름과 함께 다운로드됩니다.

### 파일 삭제:

사용자는 자신이 업로드한 파일을 삭제할 수 있으며, 삭제 시 서버에서 파일과 관련된 메타데이터가 모두 제거됩니다.

----

## 조건
- s3를 이용한 파일 crud를 진행할 것.
- 예외처리는 본인 재량껏 처리
- redis를 사용하여 jwt refreshToken을 관리할 것 (다른 로직에서도 redis를 활용해도 괜찮음)
